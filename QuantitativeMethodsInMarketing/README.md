# Прогнозирование временных рядов с ARIMA 

## Описание проекта
Этот проект реализует модель ARIMA для прогнозирования временных рядов и включает проверку адекватности модели. Код написан на R и позволяет анализировать временные ряды, подбирать параметры модели и оценивать её качество с помощью статистических тестов.

## Условия для запуска

### Требования:

- Установленный R (версия 4.0 или выше)

- Установленный пакет forecast (install.packages("forecast"))

- Установленный пакет tseries (install.packages("tseries"))

## Запуск:

1. Открыть RStudio или консоль R.

2. Запустить код: source("script.R")

---

## Модель ARIMA

### Временные ряды

Временной ряд — это последовательность наблюдений, упорядоченных по времени: 
$[ X_t, X_{t+1}, \dots, X_n ]$

#### Авторегрессионные модели (AR)
Модель AR(p) выражает текущее значение как линейную комбинацию предыдущих значений:
$ X_t = c + \sum_{i=1}^{p} \phi_i X_{t-i} + \varepsilon_t $
где:
- $( \phi_i )$ — коэффициенты авторегрессии,
- $( \varepsilon_t )$ — белый шум.

#### Скользящее среднее (MA)
Модель MA(q) выражает текущее значение через случайные ошибки:
$ X_t = \mu + \sum_{j=1}^{q} \theta_j \varepsilon_{t-j} + \varepsilon_t $
где:
- $ ( \theta_j )$ — коэффициенты скользящего среднего.

#### Комбинированная модель ARMA(p, q)
Модель ARMA(p, q) объединяет AR и MA:
$ X_t = c + \sum_{i=1}^{p} \phi_i X_{t-i} + \sum_{j=1}^{q} \theta_j \varepsilon_{t-j} + \varepsilon_t $

#### Интегрированная модель ARIMA(p, d, q)
Модель ARIMA(p, d, q) включает дифференцирование временного ряда (параметр d), чтобы сделать его стационарным:
$ (1 - B)^d X_t = c + \sum_{i=1}^{p} \phi_i X_{t-i} + \sum_{j=1}^{q} \theta_j \varepsilon_{t-j} + \varepsilon_t $
где B  — оператор сдвига $( B X_t = X_{t-1} )$.

---

## Проверка адекватности модели
После подгонки модели ARIMA важно проверить её качество.

### 1. Критерий пиков и впадин

**Определение серий "пиков и впадин"**
   - Рассчитываются разности между соседними элементами: `diff(x)`.
   - Если разность положительная, направление считается "вверх" (`+`), если отрицательная – "вниз" (`-`).
   - Последовательности одинаковых знаков считаются одной серией.
   - Количество серий записывается в `nruns`.

**Вычисление математического ожидания (mean)**
   - Используется формула: `mean = (2 * n - 1) / 3`, где `n` – количество элементов в ряду.

**Вычисление корректировки (correct)**
   - Вычисляется поправка: `correct = -0.5 * (nruns - mean) / abs(nruns - mean)`.
   - Если разность `nruns - mean` равна `0`, корректировка принимает значение `0`.

**Вычисление стандартного отклонения (sigma)**
   - Используется формула: `sigma = sqrt((16 * n - 29) / 90)`.

**Вычисление Z-статистики**
   - Z-значение рассчитывается по формуле: `z = (nruns - mean + correct) / sigma`.

**Проверка статистической гипотезы**
   - Определяется критическое значение: `zCritical = qnorm(0.975)`.
   - Если `zCritical - z > 0`, принимается гипотеза **H0** (остатки имеют случайное направление), иначе **H1** (остатки не случайны).

### 2. Медианный критерий
**Вычисление медианы**  
   Используем стандартную функцию R:
   ```R
   med <- median(x)
   ```

**Определение знаков**
Каждое значение сравнивается с медианой:
- Если значение больше медианы, ставим `+`
- Если значение меньше медианы, ставим `-`

**Подсчет числа серий (nruns)**
Серии — это последовательности одинаковых знаков (`+` или `-`), разделенные переходом на другой знак.

Алгоритм:
- Перебираем последовательность знаков.
- Фиксируем смену `+` на `-` и наоборот.
- Подсчитываем количество таких изменений.

**Вычисление дополнительных параметров**
- `n` — общее количество элементов в ряду.
- `n0` — количество значений выше медианы (`+`).
- `n1` — количество значений ниже медианы (`-`).
- `mean` — математическое ожидание количества серий: ` mean = 1 + ((2 * n0 * n1)/n) `
- `correct` — поправочный коэффициент, учитывающий небольшие отклонения: `correct = -0.5 * (nruns - mean) / abs(nruns - mean)`.
- `sigma` — стандартное отклонение: ` sigma = sqrt((2 * n0 * n1 * (2 * n0 * n1 - n)) / (n^2 * (n - 1))) `.

**Вычисление Z-статистики**
   - Z-значение рассчитывается по формуле: `z = (nruns - mean + correct) / sigma`.

**Проверка гипотез**
Гипотезы:
- **H0**: Распределение остатков имеется.
- **H1**: Распределение остатков не имеется.

### 3. Проверка Автокорреляции остатков
Тест основан на проверке гипотезы о независимости остатков временного ряда. Рассчитывается статистика теста по формуле:

$Q = n \sum_{k=1}^{m} \rho_k^2$

где:
- ( Q ) — статистика Box-Pierce,
- ( n ) — количество наблюдений,
- $( \rho_k )$ — автокорреляция на лаге \( k \),
- ( m ) — максимальный лаг.

p-value теста определяется по распределению хи-квадрат с \( m ) степенями свободы. Если p-value больше 0.05, принимается нулевая гипотеза (остатки независимы).

### 4. Проверка постоянного среднего
Одновыборочный t-тест предназначен для проверки гипотезы о равенстве среднего значения выборки некоторому фиксированному значению $( \mu_0 )$.

**Гипотезы**

- **Нулевая гипотеза (H₀):** Среднее значение выборки равно $( \mu_0 )$, т.е. остатки имеют постоянное среднее.
- **Альтернативная гипотеза (H₁):** Среднее значение отличается от $( \mu_0 )$, т.е. остатки не имеют постоянного среднего.

#### Формулы расчета

**Вычисление выборочного среднего**

$bar{x} = \frac{1}{n} \sum_{i=1}^{n} x_i$

где ( n ) — количество наблюдений, а $( x_i )$ — элементы выборки.

**Выборочное стандартное отклонение**

$s = \sqrt{\frac{1}{n-1} \sum_{i=1}^{n} (x_i - \bar{x})^2}$

**Вычисление t-статистики**

$t = \frac{\bar{x} - \mu_0}{s / \sqrt{n}}$

**Определение p-value**
p-value рассчитывается на основе распределения Стьюдента (t-распределения) с $( n-1 )$ степенями свободы:

$ p = 2 \cdot P(T > |t|)$

Если p-value **больше 0.05**, принимается нулевая гипотеза H₀, в противном случае принимается H₁.

**Доверительный интервал для среднего**

$CI = \bar{x} \pm t_{crit} \cdot \frac{s}{\sqrt{n}}$

где $( t_{crit} )$ — критическое значение t-распределения для заданного уровня доверия (например, 99%).

### 5. Проверка постоянства дисперсий
Тест Фишера (F-test) используется для проверки гипотезы о равенстве дисперсий двух групп данных. В контексте временных рядов этот тест помогает определить, отличаются ли вариативности (разброс значений) в двух частях выборки. Это важно, поскольку неоднородность дисперсий может повлиять на корректность статистического анализа.



5. Заключение

Этот проект демонстрирует процесс прогнозирования временных рядов с ARIMA и методы проверки качества модели. Он полезен для анализа финансовых данных, климатологии и прогнозирования спроса.