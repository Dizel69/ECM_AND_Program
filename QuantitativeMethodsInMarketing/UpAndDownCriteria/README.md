# Критерий пиков и впадин

## Описание проекта
Этот проект реализует проверку случайности направлений изменений числового ряда с помощью критерия "пиков и впадин". 
Программа анализирует последовательность чисел, строит график ряда, вычисляет критерий "пиков и впадин" и проверяет статистическую гипотезу:

- **H0**: Остатки имеют случайное направление.
- **H1**: Остатки не имеют случайного направления.

## Требования
Для работы программы требуется установленный язык **R**.

## Установка и запуск
1. **Убедитесь, что у вас установлен R**. Если нет, скачайте и установите R с официального сайта: https://cran.r-project.org/
2. **Скачайте или создайте CSV-файл** с числовыми данными в следующем формате:

   ```csv
   Value
   -1.86
   1.39
   -2.86
   -0.11
   0.64
   0.14
   -1.11
   0.64
   -0.11
   -0.62
   ```
   Важно: значения в столбце **Value** должны быть записаны с точкой (`.`) в качестве десятичного разделителя.

3. **Сохраните CSV-файл** в удобное место, например, `data.csv` в той же папке, где находится ваш R-скрипт.

4. **Запустите R и выполните скрипт**:
   ```R
   source("UpAndDownCriteria.R", encoding = "UTF-8")
   ```

## Алгоритм работы программы
1. **Чтение данных из CSV**
   - Файл загружается с помощью `read.csv()`.
   - Проверяется, не были ли данные загружены как текстовые строки (если да, они преобразуются в числа).

2. **Построение графика числового ряда**
   - Используется базовая функция `plot()`.
   - График содержит подписи осей и заголовок.

3. **Определение серий "пиков и впадин"**
   - Рассчитываются разности между соседними элементами: `diff(x)`.
   - Если разность положительная, направление считается "вверх" (`+`), если отрицательная – "вниз" (`-`).
   - Последовательности одинаковых знаков считаются одной серией.
   - Количество серий записывается в `nruns`.

4. **Вычисление математического ожидания (mean)**
   - Используется формула: `mean = (2 * n - 1) / 3`, где `n` – количество элементов в ряду.

5. **Вычисление корректировки (correct)**
   - Вычисляется поправка: `correct = -0.5 * (nruns - mean) / abs(nruns - mean)`.
   - Если разность `nruns - mean` равна `0`, корректировка принимает значение `0`.

6. **Вычисление стандартного отклонения (sigma)**
   - Используется формула: `sigma = sqrt((16 * n - 29) / 90)`.

7. **Вычисление Z-статистики**
   - Z-значение рассчитывается по формуле: `z = (nruns - mean + correct) / sigma`.

8. **Проверка статистической гипотезы**
   - Определяется критическое значение: `zCritical = qnorm(0.975)`.
   - Если `zCritical - z > 0`, принимается гипотеза **H0** (остатки имеют случайное направление), иначе **H1** (остатки не случайны).

## Выходные данные
Программа выводит в консоль:
- График числового ряда.
- Количество серий в ряде (`nruns`).
- Ожидаемое среднее количество серий (`mean`).
- Z-значение и критическое значение (`zCritical`).
- Итоговое решение по гипотезе (`H0` или `H1`).

Пример вывода:
```text
Число серий (nruns): 6
Теоретическое среднее число серий (mean): 6.33
Стандартное отклонение (sigma): 1.2
Поправка (correct): -0.5
z-значение: -1.05
Критическое значение (zCritical): 1.96
Вывод по гипотезе: H0
```

## Возможные ошибки и решения

1. **Ошибка: "повторяющиеся 'row.names' не разрешаются"**
   - Проверьте, что файл CSV использует точку (`.`) в качестве десятичного разделителя.
   - Убедитесь, что при загрузке данных указано `row.names = NULL`.

2. **График не строится**
   - Убедитесь, что вектор `x` содержит числовые данные (`as.numeric(x)`).

3. **R не видит файл**
   - Проверьте текущую рабочую директорию `getwd()`.
   - Используйте `setwd("путь_к_файлу")`, если файл находится в другой папке.
