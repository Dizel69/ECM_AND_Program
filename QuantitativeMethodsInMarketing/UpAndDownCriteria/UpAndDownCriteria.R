#------------------------
# Критерий пиков и впадин
#------------------------

# Считывание данных из CSV-файла
# Убедитесь, что CSV-файл находится в рабочем каталоге.
# Если файл находится в другом месте, укажите полный путь.
data <- read.table("data.csv", header = TRUE, sep = "\n", dec = ",", row.names = NULL)


# Если столбец называется не "Value", замените его имя на соответствующее.
x <- data$Value

# Проверка: если данные не найдены, можно вывести сообщение и остановить выполнение
if(is.null(x)) {
  stop("Столбец 'Value' не найден в CSV-файле. Проверьте заголовки столбцов.")
}

# Построение графика ряда с помощью базовых функций R
plot(x, type = "o", col = "blue", pch = 19, lwd = 2,
     xlab = "Индекс", ylab = "Значение",
     main = "График числового ряда")

# Вычисляем разности между соседними элементами
diffs <- diff(x)

# Определяем знаки изменений ("+" или "-")
signs <- ifelse(diffs > 0, "+", "-")

# Подсчитываем число серий (nruns)
nruns <- 1 + sum(signs[-1] != signs[-length(signs)])

# Определяем количество наблюдений
n <- length(x)

# Вычисляем теоретическое среднее число серий
# Формула: mean_runs = (2*n - 1) / 3
mean_runs <- (2 * n - 1) / 3

# Вычисляем стандартное отклонение
# Формула: sigma = sqrt((16*n - 29) / 90)
sigma <- sqrt((16 * n - 29) / 90)

# Вычисляем поправку (correct)
# Если (nruns - mean_runs) > 0, то correct = -0.5, иначе +0.5
correct <- ifelse((nruns - mean_runs) > 0, -0.5, 0.5)

# Вычисляем z-значение
# z = (nruns - mean_runs + correct) / sigma
z <- (nruns - mean_runs + correct) / sigma

# Находим критическое значение z 
z_critical <- qnorm(0.975)

# Проверка гипотезы:
# Если (zCritical - z) > 0, выводим H0, иначе H1
hypothesis <- ifelse(z_critical - z > 0, "H0: остатки имеют случайное направление", "H1: остатки не имеют случайное направление")

# Вывод результатов в консоль
cat("Число серий (nruns):", nruns, "\n")
cat("Теоретическое среднее число серий (mean):", mean_runs, "\n")
cat("Стандартное отклонение (sigma):", sigma, "\n")
cat("Поправка (correct):", correct, "\n")
cat("z-значение:", z, "\n")
cat("Критическое значение (zCritical):", z_critical, "\n")
cat("Вывод по гипотезе:", hypothesis, "\n")
